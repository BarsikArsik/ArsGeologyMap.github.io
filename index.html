<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Карта с точками и таблица из CSV</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        #map {
            height: 500px;
            width: 70%; /* Изменено для освободить место для информации */
            margin-top: 20px;
            float: left; /* Добавлено для размещения карты и блока информации рядом */
        }
        #info {
            width: 25%; /* Ширина блока информации */
            margin-top: 20px;
            padding: 10px;
            border: 1px solid black;
            float: right; /* Располагает блок информации справа */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>Данные из CSV</h1>
    
    <div id="map"></div>

    <div id="info">
        <h2>Информация о точке:</h2>
		<p id="pointID">ID: </p>
        <p id="pointName">Выберите маркер на карте.</p>
        <p id="pointDescription"></p>
		<img id="pointImage" src="" alt="Изображение точки" style="display: none; max-width: 100%; margin-top: 10px;" /> <!-- Изображение -->
    </div>

    
    <table id="dataTable">
        <thead>
            <tr>
				<th>ID</th> 
                <th>Name</th>
                <th>LAT</th>
                <th>LONG</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Инициализация карты с координатами центра и уровнем масштабирования
        const map = L.map('map').setView([51.505, -0.09], 2);

        // Добавляем OpenStreetMap слой на карту
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Автоматически загружаем CSV файл
        fetch('data.csv')  // Убедитесь, что файл находится в той же директории
            .then(response => response.text())
            .then(data => parseCSVAndAddMarkers(data))
            .catch(error => console.error('Ошибка загрузки файла:', error));

        function parseCSVAndAddMarkers(csvText) {
            const rows = csvText.split('\n');
            const tableBody = document.querySelector('#dataTable tbody');
            tableBody.innerHTML = '';  // Очищаем таблицу перед добавлением данных

            for (let i = 1; i < rows.length; i++) {  // Пропускаем первую строку с заголовками
                const row = rows[i].split(',');
                if (row.length === 5) {  // Проверяем, что есть 4 колонки
					const id = row[0].trim();
                    const name = row[1].trim();
                    const lat = parseFloat(row[2].trim());
                    const long = parseFloat(row[3].trim());
                    const description = row[4].trim();

                    // Добавляем маркер на карту с координатами
                    const marker = L.marker([lat, long]).addTo(map)
                        .bindPopup(`<b>${name}</b><br>${description}`)
                        .on('click', () => displayPointInfo(name, description,id)); // Вызываем функцию при клике на маркер

                    // Добавляем строку в таблицу
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
						<td>${id}</td>
                        <td>${name}</td>
                        <td>${lat}</td>
                        <td>${long}</td>
                        <td>${description}</td>
                    `;
                    tableBody.appendChild(tr);
                }
            }
        }

        // Функция для отображения информации о точке
        function displayPointInfo(name, description, id) {
            document.getElementById('pointName').textContent = `Название: ${name}`;
			document.getElementById('pointDescription').textContent = `Описание: ${description}`;
			document.getElementById('pointID').textContent = `ID: ${id}`;
			
			const imagePath = `${id}.jpg`;
			const imgElement = document.getElementById('pointImage');
			imgElement.src = imagePath; // Устанавливаем путь к изображению
			
			const imgCheck = new Image();
			imgCheck.src = imagePath;

			imgCheck.onload = function() {
        // Если изображение загружается успешно, показываем его
			imgElement.style.display = 'block';
		};

		imgCheck.onerror = function() {
        // Если изображение не загружается, скрываем элемент
        imgElement.style.display = 'none';
    };
        }
    </script>
</body>
</html>
